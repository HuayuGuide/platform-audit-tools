{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://huayuguide.com/schema/audit-record-read-model-v2.json",
  "title": "HuayuGuide Audit Record Read Model",
  "description": "Canonical data structure for a single platform withdrawal audit record. Generated by HuayuGuide's audit processing pipeline and stored as post meta. Powers all front-end rendering and Schema.org output.",
  "version": "2.0",
  "type": "object",
  "required": ["version", "audit_post_id", "platform_id"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Read model version for cache invalidation",
      "example": "2.0"
    },
    "audit_post_id": {
      "type": "integer",
      "description": "WordPress post ID of the audit_record CPT"
    },
    "platform_id": {
      "type": "integer",
      "description": "WordPress post ID of the related platform CPT"
    },
    "audit_score": {
      "type": "integer",
      "description": "Composite audit score: -2 (severe fail) to 2 (excellent)",
      "minimum": -2,
      "maximum": 2
    },
    "audit_status": {
      "type": "string",
      "description": "Overall audit verdict",
      "enum": ["pass", "fail", "pending", "inconclusive"]
    },
    "withdraw": {
      "type": "object",
      "description": "Withdrawal test measurements",
      "properties": {
        "duration_min": {
          "type": ["number", "null"],
          "description": "Total withdrawal processing time in minutes (null if not measured)"
        },
        "duration_text": {
          "type": "string",
          "description": "Human-readable duration (e.g., '15分钟', '1.5小时', '秒级')"
        },
        "amount_apply": {
          "type": ["number", "null"],
          "description": "Amount submitted for withdrawal"
        },
        "amount_received": {
          "type": ["number", "null"],
          "description": "Amount actually credited to the tester's account"
        },
        "currency_apply": {
          "type": "string",
          "description": "Currency of the withdrawal request",
          "examples": ["USDT", "CNY", "MYR", "HKD"]
        },
        "currency_received": {
          "type": "string",
          "description": "Currency actually received",
          "examples": ["USDT", "CNY", "MYR", "HKD"]
        },
        "speed": {
          "type": "object",
          "description": "Speed classification output from WithdrawalTimeCalculator",
          "properties": {
            "code": {
              "type": "string",
              "enum": ["instant", "fast", "normal", "slow", "unknown"]
            },
            "label": {
              "type": "string",
              "description": "Display label in Chinese"
            },
            "score": {
              "type": "integer"
            },
            "tags": {
              "type": "array",
              "items": {"type": "string"},
              "description": "Risk/quality tags for display and Schema.org additionalProperty"
            }
          }
        }
      }
    },
    "fx": {
      "type": "object",
      "description": "Foreign exchange loss analysis",
      "properties": {
        "loss_pct": {
          "type": ["number", "null"],
          "description": "Percentage of funds lost to fees/FX in same-currency withdrawal"
        },
        "deviation_pct": {
          "type": ["number", "null"],
          "description": "Percentage deviation from market mid-rate in cross-currency withdrawal"
        },
        "loss_text": {
          "type": "string",
          "description": "Human-readable loss display (e.g., '1.2%', '无汇损')"
        },
        "severe_loss": {
          "type": "boolean",
          "description": "true if loss exceeds warning threshold"
        },
        "classification": {
          "type": "object",
          "description": "FX loss classification from FxLossCalculator",
          "properties": {
            "code": {
              "type": "string",
              "enum": ["zero_loss", "minimal", "moderate", "severe", "unknown"]
            },
            "label": {"type": "string"},
            "score": {"type": "integer"},
            "tags": {
              "type": "array",
              "items": {"type": "string"}
            }
          }
        }
      }
    },
    "kyc": {
      "type": "object",
      "description": "KYC (Know Your Customer) verification requirements encountered",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["none", "sms", "id_front", "id_both", "video", "bank_statement", "full"],
          "description": "Highest KYC level triggered during this audit"
        },
        "level": {
          "type": "string",
          "enum": ["none", "light", "medium", "heavy"],
          "description": "Simplified 4-level classification for display"
        },
        "triggered_at_withdrawal": {
          "type": "boolean",
          "description": "true if KYC was only triggered at withdrawal stage (red flag)"
        }
      }
    },
    "tags": {
      "type": "array",
      "description": "All auto-generated risk/quality tags for this audit record",
      "items": {
        "type": "string"
      },
      "examples": [["秒级出款", "无汇损", "轻KYC"], ["出款偏慢", "汇损严重", "高强度KYC"]]
    },
    "schema_org": {
      "type": "object",
      "description": "Pre-computed values for Schema.org Review / Product structured data injection",
      "properties": {
        "rating_value": {
          "type": "number",
          "minimum": 1,
          "maximum": 5,
          "description": "Normalized 1-5 star rating derived from audit_score"
        },
        "review_body_snippet": {
          "type": "string",
          "description": "Auto-generated 1-sentence review body for Schema.org"
        }
      }
    },
    "updated_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of last read model generation",
      "example": "2026-02-21T00:00:00+08:00"
    }
  }
}
